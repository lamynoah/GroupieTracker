<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlindTest</title>
</head>
<body>
    <iframe id="spotifyPlayer" width="100%" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
    <label for="guess">Titre : </label>
    <input type="text" id="inputGuess" name="inputGuess">
    <button>Valid√©</button>
    <script src="https://open.spotify.com/embed/iframe-api/v1" async>
    </script>
      <script>
        let socket = new WebSocket("ws://localhost:8080/ws");
        console.log("Attempting Connection...");

        socket.onopen = () => {
            console.log("Successfully Connected");
            socket.send("Hi From the Client!")
        };

        socket.onclose = event => {
            console.log("Socket Closed Connection: ", event);
            socket.send("Client Closed!")
        };

        socket.onmessage = msg => {
            console.log("Message Recieved: ", msg);
        };

        socket.onerror = error => {
            console.log("Socket Error: ", error);
        };
    </script>
    <script>
       function updateSpotifyTrack() {
        fetch("/getTrackID")
        .then(response => response.text())
        .then(trackID => {
            var iframe = document.getElementById("spotifyPlayer");
            iframe.src = "https://open.spotify.com/embed/track/" + trackID + "?autoplay=true";
            // setTimeout(function() {
            //     iframe.src = "";
            // }, Math.floor(Math.random() * (15000 - 5000 + 1)) + 5000);
        })
        .catch(error => {
            console.error("Error fetching track ID:", error);
        });
    }
    updateSpotifyTrack();
    // setInterval(updateSpotifyTrack, 30000)
    </script>
    </script>
</html>