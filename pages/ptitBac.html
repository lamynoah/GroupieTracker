<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetitBac</title>
</head>
{{if .IsPlaying}}

<body>
    <h1> Lettre : {{.Letter}}</h1>
    <form action="/result?room={{.RoomId}}" method="post">
        <label for="artiste">Artiste:</label>
        <input placeholder="{{.Letter}}..." type="text" name="artiste" id="artiste" autofocus autocomplete="off"
            required /><br>

        <label for="album">Album:</label>
        <input placeholder="{{.Letter}}..." type="text" name="album" id="album" autocomplete="off" required /><br>

        <label for="groupe">Groupe de musique:</label>
        <input placeholder="{{.Letter}}..." type="text" name="groupe" id="groupe" autocomplete="off" required /><br>

        <label for="instrument">Instrument de musique:</label>
        <input placeholder="{{.Letter}}..." type="text" name="instrument" id="instrument" autocomplete="off"
            required /><br>

        <label for="featuring">Featuring:</label>
        <input placeholder="{{.Letter}}..." type="text" name="featuring" id="featuring" autocomplete="off"
            required /><br>
        <input id="send" type="submit" value="FINISH" />
    </form>
    {{template "socket" "ptitBac"}}
    <script>
        const getRoomId = () => new URLSearchParams(window.location.search).get("room")
        socket.onopen = () => {
            console.log(JSON.stringify({ Id: getRoomId(), Done: false }));
            socket.send(JSON.stringify({ Id: getRoomId(), Done: false }))
        };
        socket.onmessage = msg => {
            console.log("recieved :", msg.data)
            if (JSON.parse(msg.data) === "end round") {
                done(false)
            }
        }
        document.querySelector("form").addEventListener("submit", e => {
            e.preventDefault()
            done(true)
        })
        let done = (sender) => {
            if (sender) {
                socket.send(JSON.stringify({ Id: getRoomId(), Done: true }))
                console.log("send :", { Id: getRoomId(), Done: true })
            }
            const form = document.querySelector("form").submit()
        }
    </script>
</body>
{{end}}

</html>